{% extends "base.html" %}

{% block title %}Tutorial{% endblock %}

{% block extra_css %}
<style>
    .tutorial-container {
        max-width: 900px;
        margin: 40px auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .tutorial-page {
        display: none;
    }
    .tutorial-page.active {
        display: block;
    }
    .tutorial-page h2 {
        margin-bottom: 20px;
        color: #333;
    }
    .tutorial-page p {
        margin-bottom: 15px;
        line-height: 1.8;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
    }
    .form-group input, .form-group select, .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }
    .form-group textarea {
        resize: vertical;
        min-height: 100px;
    }
    .navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }
    .page-indicator {
        text-align: center;
        margin-bottom: 20px;
        color: #666;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="tutorial-container">
        <div class="page-indicator">
            <span id="pageNum">1</span> / 5
        </div>
        
        <!-- Page 1: Instructions -->
        <div class="tutorial-page active" id="page1">
            <h2>Welcome to the Tutorial</h2>
            <p style="margin-bottom: 30px; line-height: 1.8;">
                Please press the button below and review the tutorial carefully. The tutorial contains important information about how to use the evaluation tool and interact with the chatbot.
            </p>
            <p style="margin-top: 40px; text-align: center;">
                <button class="btn" onclick="openTutorialModal()" style="width: 100%; max-width: 400px; padding: 15px 30px; font-size: 18px;">View Tutorial</button>
            </p>
        </div>
        
        <!-- Page 2: Download Code -->
        <div class="tutorial-page" id="page2">
            <h2>Download the Code</h2>
            <p>Please download the code repository and open it in your code editor.</p>
            <p><strong>Instructions:</strong></p>
            <ol style="margin-left: 20px; line-height: 2;">
                <li>Download the code package provided below</li>
                <li>Extract the files to a location on your computer</li>
                <li>Open the project in your preferred code editor (VS Code, IntelliJ, etc.)</li>
            </ol>
            <div style="margin-top: 30px; text-align: center;">
                <a href="/static/iTrust.zip" download="iTrust.zip" class="btn" style="display: inline-block; text-decoration: none;">
                    ğŸ“¦ Download iTrust.zip
                </a>
            </div>
        </div>
        
        <!-- Page 3: Code Structure -->
        <div class="tutorial-page" id="page3">
            <h2>Code Structure Explanation</h2>
            
            <p style="margin-bottom: 20px; line-height: 1.8;">
                iTrust is an Electronic Health Record (EHR) system developed at NC State University for teaching software engineering. It's designed to handle patient medical records while maintaining HIPAA privacy standards.
            </p>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #333;">Who Uses iTrust?</h3>
            <p style="margin-bottom: 15px;">The system supports 8 different roles:</p>
            <ol style="margin-left: 20px; line-height: 2; margin-bottom: 30px;">
                <li><strong>Patient</strong> - Views own medical records, office visits, takes satisfaction surveys</li>
                <li><strong>LHCP (Licensed Health Care Professional)</strong> - Documents office visits, prescribes medications</li>
                <li><strong>DLHCP (Designated LHCP)</strong> - Trusted provider with full record access</li>
                <li><strong>Administrator</strong> - Manages user accounts</li>
                <li><strong>Emergency Responder</strong> - Limited emergency access</li>
                <li><strong>UAP (Unlicensed Authorized Personnel)</strong> - Data entry staff</li>
                <li><strong>Personal Representative</strong> - Legal guardian/proxy</li>
                <li><strong>Public Health Agent</strong> - Views aggregated epidemiological data</li>
            </ol>
            
            <p style="margin-bottom: 20px; line-height: 1.8;">
                The system follows a <strong>Model-View-Controller (MVC) pattern</strong> with clear separation of concerns across three layers.
            </p>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #333;">Architectural Pattern: Model-View-Controller (MVC)</h3>
            <pre style="background: #f5f5f5; padding: 20px; border-radius: 4px; overflow-x: auto; font-size: 12px; line-height: 1.4; margin-bottom: 30px;">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT BROWSER                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP Request
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIEW LAYER (JSPs)                         â”‚
â”‚  Location: WebRoot/auth/*.jsp                                â”‚
â”‚  - User interface (HTML, JavaScript)                         â”‚
â”‚  - Form submission                                           â”‚
â”‚  - Display data                                              â”‚
â”‚  - 156 JSP files                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Calls Action classes
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CONTROLLER LAYER (Actions)                   â”‚
â”‚  Location: src/main/edu/ncsu/csc/itrust/action/*.java       â”‚
â”‚  - Business logic coordination                               â”‚
â”‚  - Input validation (via Validators)                         â”‚
â”‚  - Transaction logging (HIPAA compliance)                   â”‚
â”‚  - Error handling                                            â”‚
â”‚  - 63+ Action classes                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Uses DAOs
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MODEL LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ BEANS (Data Containers)                              â”‚   â”‚
â”‚  â”‚ Location: model/old/beans/*.java                     â”‚   â”‚
â”‚  â”‚ - PatientBean, OfficeVisitBean, etc.                 â”‚   â”‚
â”‚  â”‚ - Simple getters/setters                             â”‚   â”‚
â”‚  â”‚ - 31+ Bean classes                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ DAOs (Database Access Objects)                       â”‚   â”‚
â”‚  â”‚ Location: model/old/dao/mysql/*.java                â”‚   â”‚
â”‚  â”‚ - PatientDAO, OfficeVisitDAO, etc.                    â”‚   â”‚
â”‚  â”‚ - SQL queries (PreparedStatements)                    â”‚   â”‚
â”‚  â”‚ - 24+ DAO classes                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ DATABASE (MySQL)                                      â”‚   â”‚
â”‚  â”‚ - No foreign keys (handled in application code)      â”‚   â”‚
â”‚  â”‚ - Connection pooling via DAOFactory                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #333;">Directory Structure</h3>
            <pre style="background: #f5f5f5; padding: 20px; border-radius: 4px; overflow-x: auto; font-size: 12px; line-height: 1.4; margin-bottom: 20px;">iTrust/
â”œâ”€â”€ WebRoot/                          # Web application root (deployed as WAR)
â”‚   â”œâ”€â”€ auth/                         # Protected pages (role-based)
â”‚   â”‚   â”œâ”€â”€ hcp/                     # Healthcare Provider only
â”‚   â”‚   â”œâ”€â”€ hcp-uap/                 # HCP and UAP shared
â”‚   â”‚   â”œâ”€â”€ patient/                 # Patient only
â”‚   â”‚   â”œâ”€â”€ admin/                   # Administrator only
â”‚   â”‚   â”œâ”€â”€ er/                      # Emergency Responder only
â”‚   â”‚   â”œâ”€â”€ pha/                     # Public Health Agent only
â”‚   â”‚   â””â”€â”€ staff/                   # All staff (HCP, UAP, Admin, LT)
â”‚   â”œâ”€â”€ errors/                      # Error pages (403, 404, 503)
â”‚   â”œâ”€â”€ util/                        # Utility JSPs
â”‚   â”œâ”€â”€ css/                         # Stylesheets
â”‚   â”œâ”€â”€ js/                          # JavaScript files
â”‚   â”œâ”€â”€ image/                       # Images
â”‚   â”œâ”€â”€ login.jsp                    # Login page
â”‚   â”œâ”€â”€ global.jsp                   # Global initialization (DAO, session)
â”‚   â”œâ”€â”€ header.jsp                   # Common header
â”‚   â”œâ”€â”€ footer.jsp                   # Common footer
â”‚   â””â”€â”€ WEB-INF/
â”‚       â”œâ”€â”€ web.xml                  # Servlet configuration, security constraints
â”‚       â”œâ”€â”€ tags.tld                 # Custom tag library
â”‚       â””â”€â”€ lib/                     # JAR dependencies
â”‚
â”œâ”€â”€ src/main/
â”‚   â””â”€â”€ edu/ncsu/csc/itrust/
â”‚       â”œâ”€â”€ action/                  # CONTROLLER LAYER
â”‚       â”‚   â”œâ”€â”€ AddPatientAction.java
â”‚       â”‚   â”œâ”€â”€ EditPatientAction.java
â”‚       â”‚   â”œâ”€â”€ ViewMyRecordsAction.java
â”‚       â”‚   â””â”€â”€ ... (63+ action classes)
â”‚       â”‚
â”‚       â”œâ”€â”€ model/                   # MODEL LAYER
â”‚       â”‚   â”œâ”€â”€ old/
â”‚       â”‚   â”‚   â”œâ”€â”€ beans/           # Data containers
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ PatientBean.java
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ OfficeVisitBean.java
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ... (31+ bean classes)
â”‚       â”‚   â”‚   â”‚
â”‚       â”‚   â”‚   â”œâ”€â”€ dao/            # Database access
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ DAOFactory.java      # Singleton factory
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ mysql/
â”‚       â”‚   â”‚   â”‚       â”œâ”€â”€ PatientDAO.java
â”‚       â”‚   â”‚   â”‚       â”œâ”€â”€ OfficeVisitDAO.java
â”‚       â”‚   â”‚   â”‚       â””â”€â”€ ... (24+ DAO classes)
â”‚       â”‚   â”‚   â”‚
â”‚       â”‚   â”‚   â””â”€â”€ validate/       # Input validation
â”‚       â”‚   â”‚       â”œâ”€â”€ AddPatientValidator.java
â”‚       â”‚   â”‚       â””â”€â”€ ... (validator classes)
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ [newer models]      # Some newer features use different structure
â”‚       â”‚
â”‚       â”œâ”€â”€ logger/                  # Transaction logging (HIPAA)
â”‚       â”‚   â””â”€â”€ TransactionLogger.java
â”‚       â”‚
â”‚       â”œâ”€â”€ server/                 # Servlets
â”‚       â”‚   â”œâ”€â”€ PatientSearchServlet.java
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”‚
â”‚       â””â”€â”€ exception/              # Custom exceptions
â”‚           â”œâ”€â”€ FormValidationException.java
â”‚           â””â”€â”€ ITrustException.java
â”‚
â”œâ”€â”€ src/test/java/                  # Test code
â”‚   â””â”€â”€ edu/ncsu/csc/itrust/
â”‚       â”œâ”€â”€ unit/                   # Unit tests (JUnit)
â”‚       â””â”€â”€ selenium/               # Integration tests
â”‚
â”œâ”€â”€ sql/                            # Database scripts
â”‚   â”œâ”€â”€ createTables.sql            # Schema definition
â”‚   â””â”€â”€ data/                       # Test data
â”‚
â””â”€â”€ pom.xml                         # Maven configuration</pre>
            
            <p style="margin-top: 20px; line-height: 1.8;">
                When evaluating NFRs, consider how the code structure relates to the requirements being assessed.
            </p>
        </div>
        
        <!-- Page 4: Demographics -->
        <div class="tutorial-page" id="page4">
            <h2>Demographic Information</h2>
            <p>Please provide the following information:</p>
            
            <div class="form-group">
                <label for="age">Question 1: What is your age?</label>
                <select id="age">
                    <option value="">Select...</option>
                    <option value="18-25">18-25</option>
                    <option value="26-35">26-35</option>
                    <option value="36-45">36-45</option>
                    <option value="46-55">46-55</option>
                    <option value="56-and-above">56 and above</option>
                    <option value="prefer-not-to-say">Prefer not to say</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="gender">Question 2: What is your gender?</label>
                <select id="gender">
                    <option value="">Select...</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="non-binary">Non-binary / third gender</option>
                    <option value="prefer-not-to-say">Prefer not to say</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="education">What is your highest level of education?</label>
                <select id="education">
                    <option value="">Select...</option>
                    <option value="high-school">High School Diploma or equivalent</option>
                    <option value="bachelor">Bachelor's Degree</option>
                    <option value="master">Master's Degree</option>
                    <option value="phd">Doctorate (PhD)</option>
                    <option value="prefer-not-to-say">Prefer not to say</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group" id="educationOtherGroup" style="display: none;">
                <label for="educationOther">Please specify:</label>
                <input type="text" id="educationOther" placeholder="Enter your education level">
            </div>
            
            <div class="form-group">
                <label for="experience">How many years of professional experience do you have in software development?</label>
                <select id="experience">
                    <option value="">Select...</option>
                    <option value="less-than-1">Less than 1 year</option>
                    <option value="1-3">1-3 years</option>
                    <option value="4-6">4-6 years</option>
                    <option value="7-10">7-10 years</option>
                    <option value="more-than-10">More than 10 years</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Which programming languages do you use most frequently in your work? (Select all that apply):</label>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="python" style="width: auto; margin-right: 8px;"> Python
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="javascript" style="width: auto; margin-right: 8px;"> JavaScript
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="java" style="width: auto; margin-right: 8px;"> Java
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="typescript" style="width: auto; margin-right: 8px;"> TypeScript
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="csharp" style="width: auto; margin-right: 8px;"> C#
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="cpp" style="width: auto; margin-right: 8px;"> C++
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="ruby" style="width: auto; margin-right: 8px;"> Ruby
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="go" style="width: auto; margin-right: 8px;"> Go
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="swift" style="width: auto; margin-right: 8px;"> Swift
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="kotlin" style="width: auto; margin-right: 8px;"> Kotlin
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="php" style="width: auto; margin-right: 8px;"> PHP
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="r" style="width: auto; margin-right: 8px;"> R
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="html-css" style="width: auto; margin-right: 8px;"> HTML/CSS
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="sql" style="width: auto; margin-right: 8px;"> SQL
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="rust" style="width: auto; margin-right: 8px;"> Rust
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="assembly" style="width: auto; margin-right: 8px;"> Assembly
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="perl" style="width: auto; margin-right: 8px;"> Perl
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="powershell" style="width: auto; margin-right: 8px;"> PowerShell
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="cobol" style="width: auto; margin-right: 8px;"> COBOL
                    </label>
                    <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" name="languages" value="other" id="languageOtherCheckbox" style="width: auto; margin-right: 8px;"> Other
                    </label>
                </div>
            </div>
            
            <div class="form-group" id="languageOtherGroup" style="display: none;">
                <label for="languageOther">Please specify:</label>
                <input type="text" id="languageOther" placeholder="Enter other programming languages">
            </div>
        </div>
        
        <!-- Page 5: Password -->
        <div class="tutorial-page" id="page5">
            <h2>Verification Entry</h2>
            <p>Before beginning the experiment, please confirm you have successfully downloaded and extracted the code.</p>
            <p>In the downloaded folder, open the file named "verification.txt" </p>
            
            <div class="form-group">
                <label for="password">What is the verification password written in this "verification.txt"?</label>
                <input type="text" id="password" placeholder="Enter password">
            </div>
            
            <div id="passwordError" style="color: red; margin-top: 10px; display: none;">
                Incorrect password. Please try again.
            </div>
        </div>
        
        <div class="navigation">
            <button class="btn btn-secondary" id="prevBtn" onclick="changePage(-1)" style="display: none;">Previous</button>
            <button class="btn" id="nextBtn" onclick="changePage(1)">Next</button>
        </div>
    </div>
</div>

<script>
const STATIC_PASSWORD = 'perc2026'; // Static password
let currentPage = 1;
const totalPages = 5;
let uuid = null;

// Get UUID from localStorage (should already exist from consent page)
window.addEventListener('load', () => {
    // Check if should redirect
    if (redirectToCorrectPage()) return;
    
    // Get UUID from localStorage - it should already exist from consent
    uuid = localStorage.getItem('chatbot_uuid');
    if (uuid) {
        // Validate UUID with server
        fetch('/api/get_or_create_uuid', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({uuid: uuid})
        })
        .then(r => r.json())
        .then(data => {
            uuid = data.uuid;
            localStorage.setItem('chatbot_uuid', uuid);
            setCurrentProgress(PROGRESS_STEPS.TUTORIAL, {page: currentPage});
            loadProgress();
        });
    } else {
        // UUID should exist - if not, redirect back to consent
        console.warn('No UUID found, redirecting to consent');
        window.location.href = '/';
    }
    
    // Check if modal should be opened
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('modal') === 'true') {
        setTimeout(() => openTutorialModal(), 500);
    }
    
    // Set up event listeners for "Other" fields
    setupOtherFieldListeners();
});

function setupOtherFieldListeners() {
    // Education "Other" field
    const educationSelect = document.getElementById('education');
    const educationOtherGroup = document.getElementById('educationOtherGroup');
    if (educationSelect && educationOtherGroup) {
        educationSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                educationOtherGroup.style.display = 'block';
            } else {
                educationOtherGroup.style.display = 'none';
                document.getElementById('educationOther').value = '';
            }
        });
    }
    
    // Language "Other" field
    const languageOtherCheckbox = document.getElementById('languageOtherCheckbox');
    const languageOtherGroup = document.getElementById('languageOtherGroup');
    if (languageOtherCheckbox && languageOtherGroup) {
        languageOtherCheckbox.addEventListener('change', function() {
            if (this.checked) {
                languageOtherGroup.style.display = 'block';
            } else {
                languageOtherGroup.style.display = 'none';
                document.getElementById('languageOther').value = '';
            }
        });
    }
}

function loadProgress() {
    // Load page progress from localStorage
    const savedPage = localStorage.getItem('tutorial_page');
    if (savedPage) {
        currentPage = parseInt(savedPage);
        showPage(currentPage);
    } else {
        showPage(currentPage);
    }
}

function showPage(page) {
    // Hide all pages
    for (let i = 1; i <= totalPages; i++) {
        document.getElementById(`page${i}`).classList.remove('active');
    }
    
    // Show current page
    document.getElementById(`page${page}`).classList.add('active');
    document.getElementById('pageNum').textContent = page;
    
    // Update navigation buttons
    document.getElementById('prevBtn').style.display = page === 1 ? 'none' : 'block';
    document.getElementById('nextBtn').textContent = page === totalPages ? 'Start Evaluation' : 'Next';
    
    // Update "Other" field visibility for page 4
    if (page === 4) {
        const educationSelect = document.getElementById('education');
        const educationOtherGroup = document.getElementById('educationOtherGroup');
        if (educationSelect && educationOtherGroup) {
            educationOtherGroup.style.display = educationSelect.value === 'other' ? 'block' : 'none';
        }
        
        const languageOtherCheckbox = document.getElementById('languageOtherCheckbox');
        const languageOtherGroup = document.getElementById('languageOtherGroup');
        if (languageOtherCheckbox && languageOtherGroup) {
            languageOtherGroup.style.display = languageOtherCheckbox.checked ? 'block' : 'none';
        }
    }
}

function changePage(direction) {
    if (direction === 1) {
        // Validate current page before proceeding
        if (currentPage === 4) {
            // Validate demographics
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const education = document.getElementById('education').value;
            const educationOther = document.getElementById('educationOther').value;
            const experience = document.getElementById('experience').value;
            
            // Get selected programming languages
            const languageCheckboxes = document.querySelectorAll('input[name="languages"]:checked');
            const languages = Array.from(languageCheckboxes).map(cb => cb.value);
            const languageOther = document.getElementById('languageOther').value;
            
            if (!age || !gender || !education || !experience) {
                alert('Please fill in all required demographic fields.');
                return;
            }
            
            // Validate education "Other" field
            if (education === 'other' && !educationOther.trim()) {
                alert('Please specify your education level.');
                return;
            }
            
            // Validate programming languages - at least one must be selected
            if (languages.length === 0) {
                alert('Please select at least one programming language.');
                return;
            }
            
            // Validate language "Other" field if checked
            if (languages.includes('other') && !languageOther.trim()) {
                alert('Please specify the other programming languages.');
                return;
            }
            
            // Save demographics to JSON file
            const demographics = {
                uuid: uuid,
                age: age,
                gender: gender,
                education: education,
                educationOther: education === 'other' ? educationOther : null,
                experience: experience,
                languages: languages,
                languageOther: languages.includes('other') ? languageOther : null
            };
            
            fetch('/api/submit_demographics', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(demographics)
            });
        } else if (currentPage === 5) {
            // Validate password
            const password = document.getElementById('password').value;
            if (password !== STATIC_PASSWORD) {
                document.getElementById('passwordError').style.display = 'block';
                return;
            }
        }
        
        if (currentPage === totalPages) {
            // Save progress and go to evaluation
            localStorage.setItem('tutorial_page', currentPage.toString());
            setCurrentProgress(PROGRESS_STEPS.EVALUATION, {batch: 1});
            window.location.href = '/evaluation?batch=1';
            return;
        }
        currentPage++;
    } else {
        currentPage--;
    }
    
    showPage(currentPage);
    // Save page progress to localStorage
    localStorage.setItem('tutorial_page', currentPage.toString());
    setCurrentProgress(PROGRESS_STEPS.TUTORIAL, {page: currentPage});
}

showPage(currentPage);
</script>
{% endblock %}
